<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thêm Học Sinh Mới - SchoolHealth</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/add-student.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header Section -->
    <header>
        <div class="top-bar">
            <div class="container">
                <div class="contact-info">
                    <div><i class="fas fa-map-marker-alt"></i>Đại học FPT Campus HCM</div>
                    <div><i class="fas fa-phone-alt"></i> +84 123 999 9999</div>
                    <div><i class="fas fa-envelope"></i> fptDaiGaKu@schoolhealthsystem.com</div>
                </div>
                <div class="social-links">
                    <a href="#"><i class="fab fa-linkedin-in"></i></a>
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-youtube"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                </div>
                <div class="search-container">
                    <i class="fas fa-search"></i>
                    <span>Search</span>
                </div>
            </div>
        </div>
        <nav>
            <div class="container">
                <a href="index.html" class="logo">
                    <img src="images/imagez/LOGO_Health.png" alt="SchoolHealth Logo">
                    <span>SchoolHealth</span>
                </a>
                <div class="nav-links">
                    <a href="dashboard.html">Bảng điều khiển</a>
                    <a href="news.html">Tin tức</a>
                    <a href="partners.html">Đối tác</a>
                    <a href="contact.html">Liên hệ</a>
                </div>
                <div class="user-profile">
                    <span>Y tá học đường</span>
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <button class="logout-btn">Đăng xuất</button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <div class="header-content">
                <div class="header-text">
                    <ul class="breadcrumb">
                        <li><a href="dashboard.html">Bảng điều khiển</a></li>
                        <li>Thêm học sinh mới</li>
                    </ul>
                    <h1 class="page-title">Thêm Học Sinh Mới</h1>
                    <p class="page-description">Vui lòng điền đầy đủ thông tin để tạo hồ sơ sức khỏe cho học sinh mới</p>
                </div>
                <div class="header-icon">
                    <i class="fas fa-user-plus"></i>
                </div>
            </div>
        </div>
    </section>

    <!-- Form Section -->
    <section class="container">
        <div class="student-form-container">
            <!-- Success Message (Hidden by default) -->
            <div class="form-message success" style="display: none;">
                <i class="fas fa-check-circle"></i>
                <span>Hồ sơ học sinh đã được tạo thành công!</span>
            </div>
            
            <!-- Error Message (Hidden by default) -->
            <div class="form-message error" style="display: none;">
                <i class="fas fa-exclamation-circle"></i>
                <span>Có lỗi xảy ra. Vui lòng kiểm tra lại các thông tin.</span>
            </div>
            
            <form id="add-student-form" novalidate>
                <!-- Personal Information -->
                <div class="form-section">
                    <h2><i class="fas fa-user"></i> Thông tin cá nhân</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="student_id">Mã học sinh <span class="required">*</span></label>
                            <input type="text" id="student_id" name="student_id" class="form-control" required>
                        </div>
                        <div class="form-group photo-upload">
                            <div class="photo-preview">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="upload-btn-wrapper">
                                <button type="button" class="btn btn-upload"><i class="fas fa-camera"></i> Tải ảnh lên</button>
                                <input type="file" name="student_photo" id="student_photo" accept="image/*">
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="first_name">Họ <span class="required">*</span></label>
                            <input type="text" id="first_name" name="first_name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="last_name">Tên <span class="required">*</span></label>
                            <input type="text" id="last_name" name="last_name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="dob">Ngày sinh <span class="required">*</span></label>
                            <input type="date" id="dob" name="dob" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="gender">Giới tính <span class="required">*</span></label>
                            <select id="gender" name="gender" class="form-control" required>
                                <option value="">-- Chọn giới tính --</option>
                                <option value="male">Nam</option>
                                <option value="female">Nữ</option>
                                <option value="other">Khác</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="class">Lớp <span class="required">*</span></label>
                            <input type="text" id="class" name="class" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="grade">Khối <span class="required">*</span></label>
                            <select id="grade" name="grade" class="form-control" required>
                                <option value="">-- Chọn khối --</option>
                                <option value="1">Khối 1</option>
                                <option value="2">Khối 2</option>
                                <option value="3">Khối 3</option>
                                <option value="4">Khối 4</option>
                                <option value="5">Khối 5</option>
                                <option value="6">Khối 6</option>
                                <option value="7">Khối 7</option>
                                <option value="8">Khối 8</option>
                                <option value="9">Khối 9</option>
                                <option value="10">Khối 10</option>
                                <option value="11">Khối 11</option>
                                <option value="12">Khối 12</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Contact Information -->
                <div class="form-section">
                    <h2><i class="fas fa-address-book"></i> Thông tin liên hệ</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="address">Địa chỉ <span class="required">*</span></label>
                            <input type="text" id="address" name="address" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="city">Thành phố/Tỉnh <span class="required">*</span></label>
                            <input type="text" id="city" name="city" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="parent_name">Họ và tên phụ huynh <span class="required">*</span></label>
                            <input type="text" id="parent_name" name="parent_name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="parent_phone">Số điện thoại phụ huynh <span class="required">*</span></label>
                            <input type="tel" id="parent_phone" name="parent_phone" class="form-control" pattern="[0-9]{10,11}" required>
                        </div>
                        <div class="form-group">
                            <label for="parent_email">Email phụ huynh</label>
                            <input type="email" id="parent_email" name="parent_email" class="form-control">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="emergency_contact">Liên hệ khẩn cấp <span class="required">*</span></label>
                            <input type="tel" id="emergency_contact" name="emergency_contact" class="form-control" pattern="[0-9]{10,11}" required>
                        </div>
                        <div class="form-group">
                            <label for="relationship">Mối quan hệ <span class="required">*</span></label>
                            <input type="text" id="relationship" name="relationship" class="form-control" required>
                        </div>
                    </div>
                </div>

                <!-- Health Information -->
                <div class="form-section">
                    <h2><i class="fas fa-heartbeat"></i> Thông tin sức khỏe</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="blood_type">Nhóm máu</label>
                            <select id="blood_type" name="blood_type" class="form-control">
                                <option value="">-- Chọn nhóm máu --</option>
                                <option value="A+">A+</option>
                                <option value="A-">A-</option>
                                <option value="B+">B+</option>
                                <option value="B-">B-</option>
                                <option value="O+">O+</option>
                                <option value="O-">O-</option>
                                <option value="AB+">AB+</option>
                                <option value="AB-">AB-</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="height">Chiều cao (cm)</label>
                            <input type="number" id="height" name="height" class="form-control" min="0" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="weight">Cân nặng (kg)</label>
                            <input type="number" id="weight" name="weight" class="form-control" min="0" step="0.1">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group full-width">
                            <label>Tiền sử bệnh</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="allergy" name="health_conditions[]" value="allergy">
                                    <label for="allergy">Dị ứng</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="asthma" name="health_conditions[]" value="asthma">
                                    <label for="asthma">Hen suyễn</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="diabetes" name="health_conditions[]" value="diabetes">
                                    <label for="diabetes">Tiểu đường</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="heart_condition" name="health_conditions[]" value="heart_condition">
                                    <label for="heart_condition">Bệnh tim</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="seizure" name="health_conditions[]" value="seizure">
                                    <label for="seizure">Co giật, động kinh</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="other_condition" name="health_conditions[]" value="other">
                                    <label for="other_condition">Khác</label>
                                </div>
                                <div class="checkbox-item other-condition-details" style="display: none;">
                                    <input type="text" id="other_condition_details" name="other_condition_details" class="form-control" placeholder="Nhập tên bệnh khác">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group full-width">
                            <label for="allergy_details">Chi tiết dị ứng (nếu có)</label>
                            <textarea id="allergy_details" name="allergy_details" class="form-control"></textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group full-width">
                            <label for="medication">Thuốc đang sử dụng</label>
                            <textarea id="medication" name="medication" class="form-control"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Additional Notes -->
                <div class="form-section">
                    <h2><i class="fas fa-sticky-note"></i> Ghi chú thêm</h2>
                    <div class="form-row">
                        <div class="form-group full-width">
                            <label for="notes">Ghi chú</label>
                            <textarea id="notes" name="notes" class="form-control"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="actions">
                    <button type="button" class="btn btn-secondary" id="cancel-btn">
                        <i class="fas fa-times"></i> Hủy
                    </button>
                    <div>
                        <button type="button" class="btn btn-primary" id="save-draft-btn">
                            <i class="fas fa-save"></i> Lưu nháp
                        </button>
                        <button type="submit" class="btn btn-success" id="submit-btn">
                            <i class="fas fa-check"></i> Tạo hồ sơ
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-top">
                <div class="logo">
                    <img src="images/imagez/LOGO_Health.png" alt="SchoolHealth Logo">          
                    <span>SchoolHealth</span>
                </div>
                <div class="footer-links">
                    <div class="link-group">
                        <h4>Giải pháp</h4>
                        <a href="#">Trường K-12</a>
                        <a href="#">Trung tâm Y tế</a>
                        <a href="#">Đại học</a>
                    </div>
                    <div class="link-group">
                        <h4>Tài nguyên</h4>
                        <a href="#">Blog</a>
                        <a href="#">Nghiên cứu điển hình</a>
                        <a href="#">Hướng dẫn</a>
                    </div>
                    <div class="link-group">
                        <h4>Công ty</h4>
                        <a href="#">Về chúng tôi</a>
                        <a href="#">Cơ hội nghề nghiệp</a>
                        <a href="#">Liên hệ</a>
                    </div>
                    <div class="link-group">
                        <h4>Pháp lý</h4>
                        <a href="#">Chính sách Bảo mật</a>
                        <a href="#">Điều khoản Dịch vụ</a>
                        <a href="#">Tuân thủ HIPAA</a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 SchoolHealth. Bảo lưu mọi quyền.</p>
                <div class="social-links">
                    <a href="#"><i class="fab fa-linkedin-in"></i></a>
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-youtube"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('add-student-form');
            const successMessage = document.querySelector('.form-message.success');
            const errorMessage = document.querySelector('.form-message.error');
            const submitBtn = document.getElementById('submit-btn');
            const saveDraftBtn = document.getElementById('save-draft-btn');
            const cancelBtn = document.getElementById('cancel-btn');
            
            // Photo Upload Preview
            const photoInput = document.getElementById('student_photo');
            const photoPreview = document.querySelector('.photo-preview');
            
            photoInput?.addEventListener('change', function() {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        photoPreview.innerHTML = `<img src="${e.target.result}" alt="Student Photo">`;
                    }
                    reader.readAsDataURL(file);
                }
            });
            
            // Handle allergy checkbox to show/hide details
            const allergyCheckbox = document.getElementById('allergy');
            const allergyDetails = document.getElementById('allergy_details')?.parentElement?.parentElement;
            
            allergyCheckbox?.addEventListener('change', function() {
                if (allergyDetails) {
                    allergyDetails.style.display = this.checked ? 'flex' : 'none';
                }
            });
            
            // Initialize - hide allergy details if not checked
            if (allergyDetails) {
                allergyDetails.style.display = allergyCheckbox?.checked ? 'flex' : 'none';
            }
            
            // Handle "Other" condition checkbox
            const otherConditionCheckbox = document.getElementById('other_condition');
            const otherConditionDetails = document.querySelector('.other-condition-details');
            
            otherConditionCheckbox?.addEventListener('change', function() {
                if (otherConditionDetails) {
                    otherConditionDetails.style.display = this.checked ? 'flex' : 'none';
                    if (this.checked) {
                        // Focus the input field when checkbox is checked
                        document.getElementById('other_condition_details')?.focus();
                    } else {
                        // Clear the field when unchecked
                        const otherDetailsInput = document.getElementById('other_condition_details');
                        if (otherDetailsInput) {
                            otherDetailsInput.value = '';
                        }
                    }
                }
            });
            
            // Initialize - hide other condition details if not checked
            if (otherConditionDetails) {
                otherConditionDetails.style.display = otherConditionCheckbox?.checked ? 'flex' : 'none';
            }
            
            // Form submission handling
            form?.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Hide any previous messages
                if (successMessage) successMessage.style.display = 'none';
                if (errorMessage) errorMessage.style.display = 'none';
                
                // Validate form
                if (validateForm()) {
                    // Disable submit button and show loading state
                    if (submitBtn) {
                        submitBtn.disabled = true;
                        submitBtn.classList.add('loading');
                    }
                    
                    try {
                        // Simulate API call
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        
                        // Show success message
                        if (successMessage) {
                            successMessage.style.display = 'flex';
                            form.reset();
                            if (photoPreview) {
                                photoPreview.innerHTML = '<i class="fas fa-user"></i>';
                            }
                            
                            // Scroll to top to see the message
                            window.scrollTo({top: 0, behavior: 'smooth'});
                            
                            // Redirect to dashboard after 3 seconds
                            setTimeout(() => {
                                window.location.href = 'dashboard.html';
                            }, 3000);
                        }
                    } catch (err) {
                        // Show error message
                        if (errorMessage) {
                            errorMessage.style.display = 'flex';
                            window.scrollTo({top: 0, behavior: 'smooth' });
                        }
                    } finally {
                        // Re-enable submit button and remove loading state
                        if (submitBtn) {
                            submitBtn.disabled = false;
                            submitBtn.classList.remove('loading');
                        }
                    }
                } else {
                    // Show error message
                    if (errorMessage) {
                        errorMessage.style.display = 'flex';
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                }
            });
            
            // Cancel button
            cancelBtn?.addEventListener('click', function() {
                if (confirm('Bạn có chắc muốn hủy? Mọi thông tin sẽ không được lưu.')) {
                    window.location.href = 'dashboard.html';
                }
            });
            
            // Save draft button
            saveDraftBtn?.addEventListener('click', async function() {
                if (saveDraftBtn) {
                    saveDraftBtn.disabled = true;
                    saveDraftBtn.classList.add('loading');
                }
                
                try {
                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 500));
                    alert('Đã lưu nháp thành công!');
                } finally {
                    if (saveDraftBtn) {
                        saveDraftBtn.disabled = false;
                        saveDraftBtn.classList.remove('loading');
                    }
                }
            });
            
            // Simple form validation
            function validateForm() {
                const requiredFields = form?.querySelectorAll('[required]');
                let valid = true;
                
                requiredFields?.forEach(field => {
                    if (!field.value.trim()) {
                        valid = false;
                        field.classList.add('invalid');
                    } else {
                        field.classList.remove('invalid');
                    }
                });
                
                return valid;
            }

            // Xử lý nút đăng xuất chuyển về trang chính
            const logoutBtn = document.querySelector('.logout-btn');
            logoutBtn?.addEventListener('click', function() {
                window.location.href = 'index.html';
            });
        });
    </script>
</body>
</html>